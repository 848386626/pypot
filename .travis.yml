language: generic

# os:
#   - linux
#   - osx
python:
  - 2.7
  - 3.4

matrix:
  include:
    # hack to use osx vm
    - os: osx
      language: objective-c
      env: PYTHON_VERSION=2.7 TRAVIS_OS_NAME=osx
    - os: osx
      language: objective-c
      env: PYTHON_VERSION=3.4 TRAVIS_OS_NAME=osx

    # Linux VM
    - os: linux
      env: PYTHON_VERSION=2.7 TRAVIS_OS_NAME=linux

    - os: linux
      env: PYTHON_VERSION=2.7 TRAVIS_OS_NAME=linux BUILD=test-vrep SSH_VREP_SERVER=test42-vrep1.ci USE_SSH_FORWARDING=true
      sudo: required
    # - os: linux
    #   env: PYTHON_VERSION=2.7 TRAVIS_OS_NAME=linux BUILD=test-vrep SSH_VREP_SERVER=test42-vrep2.ci USE_SSH_FORWARDING=true
    #   sudo: required     
    # - os: linux
    #   env: PYTHON_VERSION=2.7 TRAVIS_OS_NAME=linux BUILD=test-vrep SSH_VREP_SERVER=test42-vrep4.ci USE_SSH_FORWARDING=true
    #   sudo: required  

    - allow_failures:
      os: linux
      env: PYTHON_VERSION=3.4 TRAVIS_OS_NAME=linux

addons:
  apt:
    packages:
      # Spoof x11 for starting vrep
      - xvfb
      # Using Vrep in another server
      - proxychains
      # For testing
      - python-numpy
      - python-scipy
   

env:
  global:
    # Directory of setup.py
    - SETUP_DIR=.
    # PyPi credentials foru ploads to Pypi on release.
    - PYPI_USERNAME=pierre-rouanet
    # PYPI_PASSWD encrypted below > travis encrypt PYPI_PASSWD=XXXXXX --add
    - secure: "ovWnNtOxp9SzfayLkI/NbeQld76FatyUm7Bdj6d9XWxokQpj130pf5uBwrUs32TCDmWJxfIC/8Jn7IA4kMWLzH/hN+M6AIc290EiSmLNaNU4HOh6hdx6qERHLSoPFVHgI1xPTEUouNWXkP3LR8nFja/iK1ai4ecGUBoIrtG0TW4="    # Used to built the repo URL https://github.com/$GH_USERNAME/$GH_USERNAME.git
    - GH_USERNAME=poppy-project
    - GH_REPO=pypot
    # Git and Github credentials for pushing documentation 
    - GIT_EMAIL=theo.segonds@inria.fr
    - GIT_NAME=show0k-travis-bot
    # GH_TOKEN encrypted below > travis encrypt GH_TOKEN=XXXXXX --add
    - secure: "D1NhRT0olL4VJce/tPfPkDkKKFn5tTiw9RjbM0Qm+eB772xh+UFXrlUVOmWhezyZ2oCgjOpXMZJFNTNHOLqQ2aWTZrX45ielzZjqtU3e12DgF+jF0dXz255bo02W4n8li9R4hW0GTnm63INZSWp6mdW8TF6Wu4n0wf3PJz7Vpi8="

    # V-REP conf
    - VREP_VERSION=3_1_2
    - VREP_ROOT_DIR=$TRAVIS_BUILD_DIR/vrep

    # travis encrypt id_rsa_encrypted_key=...
    # openssl aes-256-cbc -k $id_rsa_encrypted_key -in ../id_rsa -out id_rsa.enc
    # Key of encrypted id_rsa, ssh private key
    - secure: "pER9uKGlgCec2enMOW3E09yUeHdzI+PUj5iE5TRzj20OG5+vnoLHRpQ1jMvfIijpX2mu7nxKVViMoGv0N+yR4ryGzHBHa7/LI627l34dmhj/iF4oXwqDk7Fzwst/z7THHPN6dBXxPY+QfYkwlGsPVC8mLNNoIxP3DUvxugqHU0E="


before_install:
  - . ./ci/before_install.sh
install:
  - . ./ci/install.sh

script:
  - . ./ci/run_tests.sh

# TODO push release only if it is a new release
after_success:
  - . ./ci/update_documentation.sh
  - . ./ci/after_success_release.sh


notifications:
  email: false
